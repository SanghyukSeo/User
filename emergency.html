<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Event-aid</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  
  <header>
    <button class="back-button" onclick="history.back()">
    <img src="back.svg" alt="Back">
  </button>
  <img src="Assets/Logo.svg" alt="Event Aid Logo" class="logo">
</header>

<div class="emergency-section">
  <p class="emergency-title"></p>
  <div class="emergency-grid">
    <div class="emergency-option" onclick="selectEmergency('Fainting', this)">
    <img src="Assets/Group2.svg" alt="Fainting Icon">
    <span>FAINT</span>
  </div>
  <div class="emergency-option" onclick="selectEmergency('Substance Abuse', this)">
    <img src="Assets/Group.svg" alt="Substance Abuse Icon">
    <span>SUBSTANCE</span>
  </div><!--
  <div class="emergency-option" onclick="selectEmergency('Dehydration', this)">
    <img src="Assets/Dehydration.svg" alt="Dehydration Icon">
    <span>DEHYDRATION</span>
  </div> -->
  <div class="emergency-option" onclick="selectEmergency('Fighting', this)">
    <img src="Assets/fighting.svg" alt="Fighting Icon">
    <span>FIGHT</span>
  </div>
  <div class="emergency-option" onclick="selectEmergency('Other', this)">
    <img src="Assets/Dehydration.svg" alt="Other Icon">
    <span>OTHER</span>
  </div>
  </div>
</div>


  <div class="tab-content active-tab" id="home">
    <!-- 제거 또는 일반 버튼만 유지 -
    <button class="alert-btn aid-btn" onclick="startReport('Non-Life Threatening')">
      General help
    </button> -->
    <div id="map-container"></div>
  </div>

  
  <!-- Emergency 버튼은 화면 맨 아래에 고정 -->
  <button class="fixed-emergency-btn" onclick="startReport()">

    <img src="Assets/Voice_left.svg" alt="" class="icon">
    REQUEST HELP
    <img src="Assets/Voice.svg" alt="" class="icon">
  </button>
  

  <div class="tab-content" id="info">
    <p>Event Aid is an innovative emergency response platform created to improve on-site safety at large public gatherings such as music festivals, sports events, and outdoor celebrations. Designed for rapid, mobile-based incident reporting, the platform empowers attendees to immediately alert medical responders while pinpointing exact GPS locations. With a clean, user-friendly interface and mobile-first design, Event Aid transforms the way emergency teams receive and respond to calls for help, making large-scale events safer and more accessible for everyone.</p>
    <img src="mit_info.jpg" alt="Info"/>
  </div>

  <div class="tab-content" id="history">
    <p>The concept for Event Aid was born during the Spring 2025 Product Design and Development course at the Massachusetts Institute of Technology (MIT). Developed by a dynamic team of two MIT students and three collaborators from the Rhode Island School of Design (RISD), the project addressed a critical pain point: delayed emergency response during densely packed festivals and sporting events. With over 2,000 major U.S. events held annually and thousands of outdoor rescue operations, the team recognized a significant gap in real-time medical communication. Event Aid emerged as a cutting-edge, user-centered solution aimed at accelerating care delivery in high-density environments — ultimately improving safety and outcomes for everyone involved.</p>
    <img src="mit_history.jpg" alt="History"/>
  </div>

  <div class="tab-content" id="venue" style="overflow:auto; max-height:70vh;">
    <div id="zoom-container" style="overflow:auto; max-height:70vh; max-width:100%; touch-action:pinch-zoom;">
      <img id="zoom-map" src="venue_map.jpg" style="width:100%; height:auto;"/>
    </div>
  </div>

  <div class="popup" id="popupForm" style="display:none;">
    <h2 style="color:red; text-align:center; margin:0.5em 0 0.3em;">HELP IS ON THE WAY</h2>
    <p style="margin:0.2em 0 0.4em;">Please stay nearby and fill out the details about the individual in need.</p>
    <form id="helpForm">
      <input id="uid" name="uid" type="hidden"/>
      <input id="authtok" name="authtok" type="hidden"/>
      <input id="etype" name="etype" type="hidden"/>
      <input id="lat" name="lat" type="hidden"/>
      <input id="long" name="long" type="hidden"/>

      <div style="display:flex;flex-direction:column;gap:0.5em;align-items:center;">
        <div style="width:75%;">
          <div class="popup-grid">
            <select name="awake"><option hidden selected value="">Awake</option><option>Unknown</option><option>Yes</option><option>No</option></select>
            <select name="breathing"><option hidden selected value="">Breathing</option><option>Unknown</option><option>Yes</option><option>No</option></select>
            <select name="vomiting"><option hidden selected value="">Vomiting</option><option>Unknown</option><option>None</option><option>Significant</option><option>Minor</option></select>
            <select name="bleeding"><option hidden selected value="">Bleeding</option><option>None</option><option>Significant</option><option>Minor</option></select>
            <select name="mood"><option hidden selected value="">Demeanor</option><option>Unknown</option><option>Calm</option><option>Hysterical</option></select>
            <select name="danger"><option hidden selected value="">Danger</option><option>Unknown</option><option>No</option><option>Self</option><option>Others</option></select>
            <select name="substances"><option hidden selected value="">Substances</option><option>Unknown</option><option>Drugs</option><option>Alcohol</option><option>Drugs &amp; Alcohol</option></select>
            <select name="scene"><option hidden selected value="">Scene</option><option>Unknown</option><option>Safe</option><option>Unsafe</option></select>
          </div>
          <input name="meds" placeholder="Current Medications" autocomplete="off"/>
          <input name="allergies" placeholder="Known Allergies" autocomplete="off"/>
          <input name="conditions" placeholder="Pre-existing Conditions" autocomplete="off"/>
          <input name="oinfo" placeholder="Other Information" autocomplete="off"/>
          <input name="cname" placeholder="Name of Person Needing Aid" autocomplete="name"/>
          <input name="rname" placeholder="Name of Person Reporting" autocomplete="name"/>
          <input name="rphone" placeholder="Phone #" autocomplete="tel"/>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;gap:1em;">
        <button class="submit-btn" type="submit">Submit Info</button>
        <button class="cancel-btn" type="button" onclick="cancelRequest()">Cancel Request</button>
      </div>
    </form>
  </div>






  <script>
    let currentUID = null, currentToken = null;
    let selectedType = null; // 선택된 emergency 타입
  
    function showTab(id) {
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active-tab'));
      document.getElementById(id).classList.add('active-tab');
    }
  
    /*
    function selectEmergency(type, buttonElement) {
      selectedType = type;
  
      // 모든 버튼 초기화
      document.querySelectorAll('.emergency-option').forEach(btn => {
        btn.style.backgroundColor = '';
        btn.querySelector('img').style.filter = ''; // SVG 필터 초기화 (흰색 해제)
      });
  
      // 선택한 버튼 스타일 변경
      buttonElement.style.backgroundColor = 'red';
      buttonElement.querySelector('img').style.filter = 'invert(1)'; // SVG를 흰색으로
  
      console.log(`Selected Emergency Type: ${selectedType}`);
    }
      */function selectEmergency(type, buttonElement) {
  selectedType = type;

// 모든 버튼에서 selected 클래스 제거
document.querySelectorAll('.emergency-option').forEach(btn => {
  btn.classList.remove('selected');
});

// 클릭한 버튼에 selected 클래스 추가
buttonElement.classList.add('selected');

console.log(`Selected Emergency Type: ${selectedType}`);
}
  
    function startReport() {
      if (!selectedType) {
        alert('Please select an emergency type first.');
        return;
      }
  
      navigator.geolocation.getCurrentPosition(pos => {
        const initData = new FormData();
        initData.append('etype', selectedType);
        initData.append('lat', pos.coords.latitude);
        initData.append('long', pos.coords.longitude);
  
        fetch('init_report.php', { method: 'POST', body: initData })
          .then(r => r.json())
          .then(d => {
            if (d.status === 'success') {
              currentUID = d.uid;
              currentToken = d.authtok;
              document.getElementById('uid').value = currentUID;
              document.getElementById('authtok').value = currentToken;
              document.getElementById('etype').value = selectedType;
              document.getElementById('lat').value = pos.coords.latitude;
              document.getElementById('long').value = pos.coords.longitude;
              document.getElementById('popupForm').style.display = 'block';
            } else {
              alert('Init failed: ' + d.message);
            }
          })
          .catch(e => { console.error(e); alert('Init error'); });
      }, _ => alert('Unable to get location'));
    }
  
    document.getElementById('helpForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const f = new FormData(this);
      fetch('update_report.php', { method: 'POST', body: f })
        .then(r => r.json())
        .then(d => {
          if (d.status === 'success') {
            alert('Report updated.');
            this.reset();
            document.getElementById('popupForm').style.display = 'none';
          } else {
            alert('Update failed: ' + d.message);
          }
        })
        .catch(e => { console.error(e); alert('Update error'); });
    });
  
    function cancelRequest() {
      const f = new FormData();
      f.append('uid', currentUID);
      f.append('authtok', currentToken);
      f.append('status', 'Canceled');
      fetch('cancel_report.php', { method: 'POST', body: f })
        .then(r => r.json())
        .then(d => {
          alert(d.status === 'success' ? 'Request canceled.' : 'Cancel failed: ' + d.message);
          document.getElementById('popupForm').style.display = 'none';
        })
        .catch(e => { console.error(e); alert('Cancel error'); });
    }
  
    function initMap() {
      const map = new google.maps.Map(document.getElementById('map-container'), {
        center: { lat: 42.3601, lng: -71.0942 }, zoom: 15
      });
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const me = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          new google.maps.Marker({
            position: me, map, title: 'You Are Here',
            icon: 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png'
          });
          map.setCenter(me);
        });
      }
    }
  </script>
  
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>
</body>
</html>
