<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Event Aid</title>

  
  <style>
    /* ‚Üê exactly your original CSS with spacing adjustments ‚Üì */
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
    header { background:#004080; padding:.5em; color:#fff; text-align:center; font-size:1.8em; font-weight:bold; }
    nav { display:flex; justify-content:space-around; background:#003060; }
    nav button { flex:1; padding:1em; color:#fff; background:none; border:none; font-size:1.2em; cursor:pointer; }
    nav button:hover, nav .active { background:#002050; }

    .tab-content { display:none; padding:0.25em; }
    .active-tab { display:block; }

    .alert-btn { width:100%; font-size:1.2em; font-weight:bold; margin:0.25em 0; padding:0.15em; border:none; border-radius:10px; cursor:pointer; color:#fff; }
    .life-btn { background:#dc3545; }
    .aid-btn  { background:#ffc107; color:#000; }

    #map-container { width:100%; height:400px; margin-top:0.15em; }

    .popup { width:95%!important; max-width:500px!important; display:flex; flex-direction:column; gap:1em;
             position:fixed; top:5%; left:50%; transform:translateX(-50%);
             background:#fff; padding:.5em; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.2);
             z-index:1000; overflow-y:auto; max-height:90vh; }
    label, select, input { width:100%; margin:0.15em 0; padding:0.15em; font-size:1em; border:1px solid #ccc; border-radius:6px; }
    .submit-btn { background:#28a745; color:#fff; }
    .cancel-btn { background:#dc3545; color:#fff; }
    .submit-btn, .cancel-btn { margin-top:0.15em; padding:1em; font-size:1.1em; font-weight:bold; width:100%; border:none; border-radius:10px; cursor:pointer; }
    img { width:100%; border-radius:10px; }
    .popup-grid { display:grid; grid-template-columns:48% 48%; row-gap:0.15em; column-gap:4.5%; }
    .popup-grid label { font-weight:bold; margin-bottom:0.15em; display:block; }
    .popup-grid select { min-width:140px; }
  </style>
</head>
<body>
  <header>üöë Event Aid</header>
  <nav>
    <button class="tablink active" onclick="showTab('home')">Emergency</button>
    <button class="tablink"        onclick="showTab('info')">Info</button>
    <button class="tablink"        onclick="showTab('history')">History</button>
    <button class="tablink"        onclick="showTab('venue')">Venue</button>
  </nav>

  <div class="tab-content active-tab" id="home">
    <button class="alert-btn life-btn" onclick="startReport('Life Threatening')">
      üö® Send Help Now. This is a Life or Death Matter.
    </button>
    <button class="alert-btn aid-btn" onclick="startReport('Non-Life Threatening')">
      ü©π Send Help. This is NOT a Life or Death Matter
    </button>
    <div id="map-container"></div>
  </div>

  <div class="tab-content" id="info">
    <p>Event Aid is an innovative emergency response platform created to improve on-site safety at large public gatherings such as music festivals, sports events, and outdoor celebrations. Designed for rapid, mobile-based incident reporting, the platform empowers attendees to immediately alert medical responders while pinpointing exact GPS locations. With a clean, user-friendly interface and mobile-first design, Event Aid transforms the way emergency teams receive and respond to calls for help, making large-scale events safer and more accessible for everyone.</p>
    <img alt="Info" src="mit_info.jpg"/>
  </div>

  <div class="tab-content" id="history">
    <p>The concept for Event Aid was born during the Spring 2025 Product Design and Development course at the Massachusetts Institute of Technology (MIT). Developed by a dynamic team of two MIT students and three collaborators from the Rhode Island School of Design (RISD), the project addressed a critical pain point: delayed emergency response during densely packed festivals and sporting events. With over 2,000 major U.S. events held annually and thousands of outdoor rescue operations, the team recognized a significant gap in real-time medical communication. Event Aid emerged as a cutting-edge, user-centered solution aimed at accelerating care delivery in high-density environments ‚Äî ultimately improving safety and outcomes for everyone involved.</p>
    <img alt="History" src="mit_history.jpg"/>
  </div>

  <div class="tab-content" id="venue" style="overflow:auto; max-height:70vh;">
    <div id="zoom-container" style="overflow:auto; max-height:70vh; max-width:100%; touch-action:pinch-zoom;">
      <img id="zoom-map" src="venue_map.jpg" style="width:100%; height:auto;" />
    </div>
  </div>

  <div class="popup" id="popupForm" style="display:none;">
    <h2 style="color:red; text-align:center; margin:0.5em 0 0.3em;">HELP IS ON THE WAY</h2>
    <p style="margin:0.2em 0 0.4em;">Please stay nearby and fill out the details about the individual in need.</p>
    <form id="helpForm">
      <!-- now includes auth token, too -->
      <input id="uid"     name="uid"     type="hidden"/>
      <input id="authtok" name="authtok" type="hidden"/>
      <input id="etype"   name="etype"   type="hidden"/>
      <input id="lat"     name="lat"     type="hidden"/>
      <input id="long"    name="long"    type="hidden"/>

      <div style="display:flex;flex-direction:column;gap:0.5em;align-items:center;">
        <div style="width:75%;">
          <div class="popup-grid">
            <select name="awake"><option hidden selected value="">Awake</option><option>Unknown</option><option>Yes</option><option>No</option></select>
            <select name="breathing"><option hidden selected value="">Breathing</option><option>Unknown</option><option>Yes</option><option>No</option></select>
            <select name="vomiting"><option hidden selected value="">Vomiting</option><option>Unknown</option><option>None</option><option>Significant</option><option>Minor</option></select>
            <select name="bleeding"><option hidden selected value="">Bleeding</option><option>None</option><option>Significant</option><option>Minor</option></select>
            <select name="mood"><option hidden selected value="">Demeanor</option><option>Unknown</option><option>Calm</option><option>Hysterical</option></select>
            <select name="danger"><option hidden selected value="">Danger</option><option>Unknown</option><option>No</option><option>Self</option><option>Others</option></select>
            <select name="substances"><option hidden selected value="">Substances</option><option>Unknown</option><option>Drugs</option><option>Alcohol</option><option>Drugs &amp; Alcohol</option></select>
            <select name="scene"><option hidden selected value="">Scene</option><option>Unknown</option><option>Safe</option><option>Unsafe</option></select>
          </div>
          <input name="meds"        placeholder="Current Medications"       autocomplete="off" />
          <input name="allergies"   placeholder="Known Allergies"            autocomplete="off" />
          <input name="conditions"  placeholder="Pre-existing Conditions"    autocomplete="off" />
          <input name="oinfo"       placeholder="Other Information"           autocomplete="off" />
          <input name="cname"       placeholder="Name of Person Needing Aid"  autocomplete="name"/>
          <input name="rname"       placeholder="Name of Person Reporting"    autocomplete="name"/>
          <input name="rphone"      placeholder="Phone #"                     autocomplete="tel"/>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;gap:1em;">
        <button class="submit-btn" type="submit">Submit Info</button>
        <button class="cancel-btn"  type="button" onclick="cancelRequest()">Cancel Request</button>
      </div>
    </form>
  </div>

  <script>
    let currentUID   = null,
        currentToken = null;

    function showTab(id) {
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active-tab'));
      document.getElementById(id).classList.add('active-tab');
    }

    function startReport(type) {
      navigator.geolocation.getCurrentPosition(pos => {
        // build init payload exactly as in your working version
        const initData = new FormData();
        initData.append('etype', type);
        initData.append('lat',   pos.coords.latitude);
        initData.append('long',  pos.coords.longitude);

        fetch('init_report.php', { method:'POST', body:initData })
          .then(r => r.json())
          .then(d => {
            if (d.status === 'success') {
              // server‚Äëassigned UID + token
              currentUID   = d.uid;
              currentToken = d.authtok;
              document.getElementById('uid').value     = currentUID;
              document.getElementById('authtok').value = currentToken;
              document.getElementById('etype').value   = type;
              document.getElementById('lat').value     = pos.coords.latitude;
              document.getElementById('long').value    = pos.coords.longitude;
              document.getElementById('popupForm').style.display = 'block';
            } else {
              alert('Init failed: ' + d.message);
            }
          })
          .catch(e => { console.error(e); alert('Init error'); });
      }, _ => alert('Unable to get location'));
    }

    document.getElementById('helpForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const f = new FormData(this);
      fetch('update_report.php', { method:'POST', body:f })
        .then(r => r.json())
        .then(d => {
          if (d.status === 'success') {
            alert('Report updated.');
            this.reset();
            document.getElementById('popupForm').style.display = 'none';
          } else {
            alert('Update failed: ' + d.message);
          }
        })
        .catch(e => { console.error(e); alert('Update error'); });
    });

    function cancelRequest() {
      const f = new FormData();
      f.append('uid',     currentUID);
      f.append('authtok', currentToken);
      f.append('status',  'Canceled');
      fetch('cancel_report.php', { method:'POST', body:f })
        .then(r => r.json())
        .then(d => {
          alert(d.status === 'success' ? 'Request canceled.' : 'Cancel failed: ' + d.message);
          document.getElementById('popupForm').style.display = 'none';
        })
        .catch(e => { console.error(e); alert('Cancel error'); });
    }

    function initMap(){
      const map = new google.maps.Map(document.getElementById('map-container'), {
        center:{lat:42.3601,lng:-71.0942}, zoom:15
      });
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          const me = {lat:pos.coords.latitude, lng:pos.coords.longitude};
          new google.maps.Marker({
            position:me, map, title:'You Are Here',
            icon:'https://maps.google.com/mapfiles/ms/icons/blue-dot.png'
          });
          map.setCenter(me);
        });
      }
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlZPcXdktuxgglm7tC4IkiHK2LMxpPfv4&callback=initMap"></script>
</body>
</html>
